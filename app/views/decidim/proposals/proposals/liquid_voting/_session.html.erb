<% if current_user %>
  <!-- A blank session[:delegated_to] means we haven't checked yet;
        let's make it explicitly the delegate email if such a delegation exists -->
  <% session[:delegated_to] = @lv_state.delegate_email %>
  <!-- A blank session[:voted] means we haven't checked yet;
      let's make it explicitly true if such a vote exists -->
  <% if session[:voted].blank? %>
    <% v = Decidim::Liquidvoting::Client.vote_for(current_user.email, proposal_url(proposal)) %>
    <% v.nil? ? session[:voted] = false : session[:voted] = true %>
  <% end -%>
<% end -%>
